# ๐ก๏ธ Mini-SIEM v1 - ูุธุงู ุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ ุงูุฃูููุฉ ุงููุตุบุฑ

> ูุธุงู SIEM ุงุญุชุฑุงูู ูุตุบุฑ ูุน ูุดู ุงููุฌูุงุช ูู ุงูููุช ุงูุญูููู ุจุงุณุชุฎุฏุงู Suricata + ููุงุฐุฌ ุชุนูู ุงูุขูุฉ

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

Mini-SIEM ูู ูุธุงู ูุดู ุงูุชูุฏูุฏุงุช ุงูุฃูููุฉ ูู ุงูููุช ุงูุญูููู ูุชููู ูู:

| ุงููููู | ุงููุธููุฉ | ุฒูู ุงูุงุณุชุฌุงุจุฉ |
|--------|---------|---------------|
| **Suricata IDS** | ูุดู ุงููุฌูุงุช ุจุงูุชูููุนุงุช (ุฃุณุงุณู) | ~1 ุซุงููุฉ |
| **SSH LSTM** | ูุดู ูุญุงููุงุช ุงูุงุฎุชุฑุงู ุนุจุฑ SSH | 1-3 ุซูุงูู |
| **Network ML** | ุชุตููู ุญุฑูุฉ ุงูุดุจูุฉ (ุซุงููู) | 2-8 ุซูุงูู |

---

## ๐๏ธ ูููู ุงููุธุงู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ุฎุงุฏู ุงูุงุณุชุดุนุงุฑ (Sensor)                      โ
โ                      192.168.1.10                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โauth_collectorโ  โ suricata โ  โ    flow_collector        โ   โ
โ  โ(tail auth.log)โ โ(AF_PACKET)โ  โ     (NFStream)           โ   โ
โ  โโโโโโโโฌโโโโโโโ  โโโโโโฌโโโโโโ  โโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ   โ
โ         โ              โ                    โ                   โ
โ         โ        โโโโโโโดโโโโโโโ             โ                   โ
โ         โ        โsuricata_   โ             โ                   โ
โ         โ        โshipper     โ             โ                   โ
โ         โ        โโโโโโโฌโโโโโโโ             โ                   โ
โโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโ
          โ              โ                   โ
          โ   POST /api/v1/ingest/* (X-API-Key)
          โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ุฎุงุฏู ุงูุชุญููู (Analysis)                      โ
โ                      192.168.1.20:8000                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                    Backend (FastAPI)                      โ  โ
โ  โ  โโโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ      โ  โ
โ  โ  โSSH LSTM  โ   โ Suricata โ   โ   Network ML     โ      โ  โ
โ  โ  โDetector  โ   โ Processorโ   โ   Classifier     โ      โ  โ
โ  โ  โโโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ      โ  โ
โ  โ                                                           โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ  โ
โ  โ  โ          UI (Jinja2 + CSS + JavaScript)           โ   โ  โ
โ  โ  โ   Dashboard | Alerts | Events | Models            โ   โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                 โผ                               โ
โ               โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                 โ
โ               โ         PostgreSQL           โ                 โ
โ               โ   raw_events | detections    โ                 โ
โ               โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ก ุฎุทุฉ ุงูุดุจูุฉ ูุงูููุงูุฐ

| ุงูุฎุงุฏู | ุงูุนููุงู | ุงููููุฐ | ุงููุตู |
|--------|---------|--------|-------|
| Analysis | 192.168.1.20 | 8000/tcp | ูุงุฌูุฉ ุงูููุจ + API |
| Sensor | 192.168.1.10 | - | (ูุง ููุงูุฐ ูุงุฑุฏุฉ) |
| PostgreSQL | ุฏุงุฎูู ููุท | 5432 | **ุบูุฑ ููุดูู ููุฎุงุฑุฌ** |

### ๐ฅ ุฅุนุฏุงุฏ ุฌุฏุงุฑ ุงูุญูุงูุฉ (UFW)

```bash
# ุนูู ุฎุงุฏู ุงูุชุญููู - ุงูุณูุงุญ ููุท ูู ุนููุงู ุงูุงุณุชุดุนุงุฑ
sudo ufw allow from 192.168.1.10 to any port 8000

# ููุน ุงููุตูู ูู ุฃู ุนููุงู ุขุฎุฑ
sudo ufw deny 8000

# ุชูุนูู ุงูุฌุฏุงุฑ
sudo ufw enable
```

---

## โก ุงูุชุซุจูุช ูุงูุชุดุบูู

### ุงููุชุทูุจุงุช

- Docker 20.10+
- Docker Compose v2+
- ูุธุงู Linux (Ubuntu/Debian/Kali) ููุงุณุชุดุนุงุฑ
- ูุงุฌูุฉ ุงูุดุจูุฉ `ens33` (ุฃู ุบูุฑูุง - ูุงุจู ููุชุบููุฑ)

---

### ๐ 1. ุฅุนุฏุงุฏ ุฎุงุฏู ุงูุชุญููู (192.168.1.20)

```bash
# 1. ุชุซุจูุช Docker
curl -fsSL https://get.docker.com | sudo sh
sudo usermod -aG docker $USER

# 2. ุงุณุชูุณุงุฎ ุงููุดุฑูุน
git clone <repository-url> Analytical-Intelligence
cd Analytical-Intelligence

# 3. ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงูููุงุฐุฌ
ls models/Host-Model/ssh_lstm.joblib
ls models/Network-Model/model.joblib
ls models/Network-Model/feature_list.json
ls models/Network-Model/label_map.json
ls models/Network-Model/preprocess_config.json

# 4. ุฅูุดุงุก ูุฌูุฏุงุช ุงูููุงุฐุฌ ุงููุทููุจุฉ
mkdir -p models/ssh models/network

# 5. ูุณุฎ ุงูููุงุฐุฌ
cp models/Host-Model/ssh_lstm.joblib models/ssh/
cp models/Network-Model/model.joblib models/network/
cp models/Network-Model/feature_list.json models/network/
cp models/Network-Model/label_map.json models/network/
cp models/Network-Model/preprocess_config.json models/network/

# 6. ุฅูุดุงุก ููู .env (ุงุฎุชูุงุฑู - ูุชุบููุฑ API Key)
cp .env.example .env
nano .env  # ุชุนุฏูู INGEST_API_KEY

# 7. ุชุดุบูู ุงููุธุงู
docker compose -f docker-compose.analysis.yml up -d

# 8. ุงูุชุธุงุฑ ุงูุชุดุบูู (30 ุซุงููุฉ ุชูุฑูุจุงู)
sleep 30

# 9. ุงูุชุญูู ูู ุงูุตุญุฉ
curl http://localhost:8000/api/v1/health

# 10. ูุชุญ ุงููุงุฌูุฉ
# ูู ุงููุชุตูุญ: http://192.168.1.20:8000
```

---

### ๐ 2. ุฅุนุฏุงุฏ ุฎุงุฏู ุงูุงุณุชุดุนุงุฑ (192.168.1.10)

```bash
# 1. ุชุซุจูุช Docker
curl -fsSL https://get.docker.com | sudo sh
sudo usermod -aG docker $USER

# 2. ุงุณุชูุณุงุฎ ุงููุดุฑูุน
git clone <repository-url> Analytical-Intelligence
cd Analytical-Intelligence

# 3. ุงูุชุญูู ูู ุงุณู ูุงุฌูุฉ ุงูุดุจูุฉ
ip link show
# ูุซุงู: ens33, eth0, enp0s3

# 4. ุฅุนุฏุงุฏ ุงููุชุบูุฑุงุช
export NET_IFACE=ens33                        # ุบููุฑ ุญุณุจ ูุงุฌูุชู
export ANALYZER_URL=http://192.168.1.20:8000
export X_API_KEY=test-api-key-12345           # ููุณ ุงูููุชุงุญ ูู Analysis

# 5. ุฅูุดุงุก ููู .env
cat > .env << EOF
NET_IFACE=${NET_IFACE}
ANALYZER_URL=${ANALYZER_URL}
X_API_KEY=${X_API_KEY}
DEVICE_ID=sensor-01
HOSTNAME=$(hostname)
DEVICE_IP=192.168.1.10
FLOW_IDLE_TIMEOUT=2
FLOW_ACTIVE_TIMEOUT=5
EOF

# 6. ุฅูุดุงุก ูุฌูุฏ ุจูุงูุงุช Suricata
mkdir -p data/suricata

# 7. ุงูุชุญูู ูู ุงูุงุชุตุงู ุจุฎุงุฏู ุงูุชุญููู
ping -c 3 192.168.1.20
curl http://192.168.1.20:8000/api/v1/health

# 8. ุชุดุบูู ุงููุธุงู
docker compose -f docker-compose.sensor.yml up -d

# 9. ูุฑุงูุจุฉ ุงูุณุฌูุงุช
docker compose -f docker-compose.sensor.yml logs -f
```

---

## โ ุงูุชุญูู ูู ุงูุชุดุบูู

### 1. ูุญุต ุงูู Health

```bash
curl -s http://192.168.1.20:8000/api/v1/health | jq
# ุงููุชููุน: {"status":"ok","timestamp":"...","version":"1.0.0"}
```

### 2. ุฅุฑุณุงู ุฃุญุฏุงุซ ุชุฌุฑูุจูุฉ

```bash
cd Analytical-Intelligence

# ุฅุฑุณุงู 10 ุฃุญุฏุงุซ ูู ูู ููุน
python scripts/sample_sender.py \
  --url http://192.168.1.20:8000 \
  --api-key test-api-key-12345 \
  --count 10

# ุฅุฑุณุงู ุฃุญุฏุงุซ SSH ููุท
python scripts/sample_sender.py --type auth --count 20

# ุฅุฑุณุงู ุฃุญุฏุงุซ Suricata ููุท
python scripts/sample_sender.py --type suricata --count 20
```

### 3. ูุฑุงูุจุฉ ุชูุจููุงุช Suricata

```bash
# ุนูู ุฎุงุฏู ุงูุงุณุชุดุนุงุฑ
tail -f data/suricata/eve.json | jq '.alert.signature // empty'
```

### 4. ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
# ุนูู ุฎุงุฏู ุงูุชุญููู
docker exec -it minisiem-postgres psql -U siem -d minisiem

-- ุนุฏุฏ ุงูุฃุญุฏุงุซ
SELECT event_type, COUNT(*) FROM raw_events GROUP BY event_type;

-- ุนุฏุฏ ุงูุชูุจููุงุช
SELECT model_name, severity, COUNT(*) FROM detections GROUP BY model_name, severity;

-- ุขุฎุฑ 10 ุชูุจููุงุช
SELECT ts, model_name, label, severity FROM detections ORDER BY ts DESC LIMIT 10;

\q
```

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ ุฎุทุฃ 401 Unauthorized

**ุงูุณุจุจ:** ููุชุงุญ API ุบูุฑ ูุชุทุงุจู

**ุงูุญู:**
```bash
# ุชุฃูุฏ ุฃู X_API_KEY ูู ุงูู Sensor = INGEST_API_KEY ูู Analysis
# ุนูู Analysis:
cat .env | grep INGEST_API_KEY

# ุนูู Sensor:
cat .env | grep X_API_KEY
```

### โ ูุงุฌูุฉ ุงูุดุจูุฉ ุบูุฑ ููุฌูุฏุฉ

**ุงูุฎุทุฃ:** `Interface ens33 not found`

**ุงูุญู:**
```bash
# ุงูุชุดู ุงููุงุฌูุฉ ุงูุตุญูุญุฉ
ip link show

# ุนุฏูู .env
nano .env
# ุบููุฑ NET_IFACE=ens33 ุฅูู ุงููุงุฌูุฉ ุงููุนููุฉ

# ุฃุนุฏ ุงูุชุดุบูู
docker compose -f docker-compose.sensor.yml down
docker compose -f docker-compose.sensor.yml up -d
```

### โ Suricata ูุง ููุชุจ eve.json

**ุงูุณุจุจ:** ุตูุงุญูุงุช ุฃู ุฅุนุฏุงุฏุงุช

**ุงูุญู:**
```bash
# ุชุญูู ูู ุงูุณุฌูุงุช
docker logs minisiem-suricata

# ุชุญูู ูู ุงูููู
ls -la data/suricata/

# ุฅุฐุง ูุงู ูุงุฑุบุงู - ุฃุนุฏ ุชุดุบูู
docker compose -f docker-compose.sensor.yml restart suricata
```

### โ ุตูุงุญูุงุช ูุฑุงุกุฉ /var/log/auth.log

**ุงูุฎุทุฃ:** `Permission denied: /var/log/auth.log`

**ุงูุญู:**
```bash
# ุนูู ุฎุงุฏู ุงูุงุณุชุดุนุงุฑ
sudo chmod 644 /var/log/auth.log

# ุฃู ุฃุถู ุงููุณุชุฎุฏู ูููุฌููุนุฉ
sudo usermod -aG adm $USER
```

### โ ูุดุงูู VMware/VirtualBox

**ุฅุฐุง ูุงู ุงูุฎุงุฏู ุงูุชุฑุงุถูุงู:**
```bash
# ุชุฃูุฏ ูู ุฃู ุงูุดุจูุฉ Bridged ูููุณ NAT
# ูู VMware: VM Settings > Network Adapter > Bridged

# ุชุฃูุฏ ูู ุชูุนูู Promiscuous Mode
# ูู VirtualBox: Settings > Network > Advanced > Promiscuous Mode: Allow All
```

---

## ๐ ุตูุญุงุช ุงููุงุฌูุฉ

| ุงูุตูุญุฉ | ุงูุฑุงุจุท | ุงููุตู |
|--------|--------|-------|
| ููุญุฉ ุงูุชุญูู | `/` | ุฅุญุตุงุฆูุงุช + ุขุฎุฑ ุงูุชูุจููุงุช |
| ุงูุชูุจููุงุช | `/alerts` | ูุงุฆูุฉ ุงูุชูุจููุงุช ูุน ููุงุชุฑ |
| ุฃุญุฏุงุซ SSH | `/events/auth` | ุณุฌูุงุช auth.log |
| ุฃุญุฏุงุซ ุงูุชุฏูู | `/events/flows` | ุชุฏููุงุช ุงูุดุจูุฉ |
| ุฃุญุฏุงุซ Suricata | `/events/suricata` | ุชูุจููุงุช Suricata |
| ุงูููุงุฐุฌ | `/models` | ุญุงูุฉ ููุงุฐุฌ ML |

---

## โฑ๏ธ ุชุนุฑูู "ุงูููุช ุงูุญูููู"

| ุงููููู | ุฒูู ุงูุงุณุชุฌุงุจุฉ | ุงูุชูุณูุฑ |
|--------|---------------|----------|
| Suricata | ~1 ุซุงููุฉ | ูุดู ููุฑู ุจุงูุชูููุนุงุช |
| SSH LSTM | 1-3 ุซูุงูู | ุชุญููู ููุฑู ููู ุณุทุฑ |
| Network ML | 2-8 ุซูุงูู | ูุนุชูุฏ ุนูู ุงูุชูุงุก ุงูุชุฏูู |
| ุชุญุฏูุซ ุงููุงุฌูุฉ | 2 ุซุงููุฉ | Polling interval |

---

## ๐ ููุงุญุธุงุช ุฃูููุฉ

> [!WARNING]
> **ุชุญุฐูุฑุงุช ูุงูุฉ ููุฅูุชุงุฌ**

1. **ุบููุฑ API Key ุงูุงูุชุฑุงุถู** ูุจู ุงููุดุฑ:
   ```bash
   # ุฅูุดุงุก ููุชุงุญ ุนุดูุงุฆู
   openssl rand -hex 32
   ```

2. **ูุง ุชูุดู PostgreSQL** ููุดุจูุฉ ุงูุฎุงุฑุฌูุฉ (ุงูุฅุนุฏุงุฏ ุงูุญุงูู ุขูู)

3. **ูููุฏ ุงููุตูู ููู Dashboard** ุนุจุฑ:
   - ุฌุฏุงุฑ ุงูุญูุงูุฉ (UFW)
   - ุฃู ุฅุถุงูุฉ ูุตุงุฏูุฉ (ูุณุชูุจูุงู)

4. **ููุฅูุชุงุฌ ุงููุนูู:**
   - ุงุณุชุฎุฏู HTTPS ูุน Nginx reverse proxy
   - ุฃุถู Rate limiting
   - ุฑุงูุจ ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ

---

## ๐ ูููู ุงููููุงุช

```
Analytical-Intelligence/
โโโ .env.example                    # ูุชุบูุฑุงุช ุงูุจูุฆุฉ
โโโ docker-compose.analysis.yml     # ุฎุงุฏู ุงูุชุญููู
โโโ docker-compose.sensor.yml       # ุฎุงุฏู ุงูุงุณุชุดุนุงุฑ
โโโ README.md                       # ูุฐุง ุงูููู
โ
โโโ scripts/
โ   โโโ init_db.sql                # ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ extract_models.sh          # ุงุณุชุฎุฑุงุฌ ุงูููุงุฐุฌ (ุงุฎุชูุงุฑู)
โ   โโโ sample_sender.py           # ุฅุฑุณุงู ุฃุญุฏุงุซ ุชุฌุฑูุจูุฉ
โ   โโโ analysis_up.sh             # ุชุดุบูู ุงูุชุญููู
โ   โโโ sensor_up.sh               # ุชุดุบูู ุงูุงุณุชุดุนุงุฑ
โ
โโโ models/
โ   โโโ ssh/                       # ูููุฐุฌ SSH LSTM
โ   โ   โโโ ssh_lstm.joblib
โ   โโโ network/                   # ูููุฐุฌ ML ููุดุจูุฉ
โ       โโโ model.joblib
โ       โโโ feature_list.json
โ       โโโ label_map.json
โ       โโโ preprocess_config.json
โ
โโโ services/
โ   โโโ backend/                   # ุฎุฏูุฉ FastAPI
โ       โโโ Dockerfile
โ       โโโ requirements.txt
โ       โโโ app/
โ           โโโ main.py
โ           โโโ config.py
โ           โโโ db.py
โ           โโโ models_loader.py
โ           โโโ security.py
โ           โโโ schemas.py
โ           โโโ detectors/
โ           โโโ ingest/
โ           โโโ ui/
โ           โโโ templates/
โ           โโโ static/
โ
โโโ agents/
    โโโ auth_collector/            # ุฌุงูุน ุณุฌูุงุช SSH
    โโโ suricata/                  # ุญุงููุฉ Suricata
    โโโ suricata_shipper/          # ุดุงุญู ุชูุจููุงุช Suricata
    โโโ flow_collector/            # ุฌุงูุน ุชุฏููุงุช ุงูุดุจูุฉ
```

---

## ๐ ุฃูุงูุฑ ูููุฏุฉ

```bash
# === ุฎุงุฏู ุงูุชุญููู ===
# ุชุดุบูู
docker compose -f docker-compose.analysis.yml up -d

# ูุฑุงูุจุฉ ุงูุณุฌูุงุช
docker compose -f docker-compose.analysis.yml logs -f backend

# ุฅููุงู
docker compose -f docker-compose.analysis.yml down

# ุฅุนุงุฏุฉ ุจูุงุก
docker compose -f docker-compose.analysis.yml up -d --build

# === ุฎุงุฏู ุงูุงุณุชุดุนุงุฑ ===
# ุชุดุบูู
docker compose -f docker-compose.sensor.yml up -d

# ูุฑุงูุจุฉ ุงูุณุฌูุงุช
docker compose -f docker-compose.sensor.yml logs -f

# ุฅููุงู
docker compose -f docker-compose.sensor.yml down

# ูุฑุงูุจุฉ Suricata
tail -f data/suricata/eve.json | jq '.'

# === ูุงุนุฏุฉ ุงูุจูุงูุงุช ===
# ุฏุฎูู PostgreSQL
docker exec -it minisiem-postgres psql -U siem -d minisiem

# ูุณุฎ ุงุญุชูุงุทู
docker exec minisiem-postgres pg_dump -U siem minisiem > backup.sql
```

---

## ๐ฏ ุฃููุงุน ุงููุฌูุงุช ุงูููุชุดูุฉ

### Suricata (ุงูุชูููุนุงุช)
- Port Scans
- SSH Brute Force
- SQL Injection
- XSS Attacks
- DoS/DDoS
- Malware Traffic
- Command Injection

### Network ML (10 ูุฆุงุช)
- BENIGN (ุญุฑูุฉ ุนุงุฏูุฉ)
- Bot
- DDoS
- DoS GoldenEye
- DoS Hulk
- DoS Slowhttptest
- DoS slowloris
- FTP-Patator
- PortScan
- SSH-Patator

### SSH LSTM
- SSH Brute Force
- SSH Anomaly (ุฃููุงุท ุบูุฑ ุนุงุฏูุฉ)
- SSH Suspicious

---

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ:
1. ุฑุงุฌุน ูุณู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุฃุนูุงู
2. ุชุญูู ูู ุณุฌูุงุช Docker
3. ุชุฃูุฏ ูู ุชุทุงุจู ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ

---

**Mini-SIEM v1.0** - ูุธุงู SIEM ูุตุบุฑ ูููุดู ุนู ุงูุชูุฏูุฏุงุช ูู ุงูููุช ุงูุญูููู ๐ก๏ธ
