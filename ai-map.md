# ğŸ—ºï¸ AI-Map - Ø®Ø±ÙŠØ·Ø© ØªØ¯ÙÙ‚ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

> Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠÙˆØ¶Ø­ Ù…Ù† Ø£ÙŠÙ† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ù…Ø§ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªÙÙ†ÙØ°ØŒ ÙˆÙƒÙŠÙ ÙŠØªÙ… Ø§Ù„Ø¹Ù…Ù„ ÙƒØ§Ù…Ù„Ø§Ù‹.

---

## ğŸŒ³ Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹

```
Analytical-Intelligence/
â”‚
â”œâ”€â”€ ğŸš€ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Analysis Server)
â”‚   â””â”€â”€ docker-compose.analysis.yml
â”‚       â”‚
â”‚       â”œâ”€â”€ postgres â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚   â””â”€â”€ scripts/init_db.sql                          â”‚
â”‚       â”‚                                                    â”‚
â”‚       â””â”€â”€ backend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           â””â”€â”€ services/backend/Dockerfile                  â”‚
â”‚               â””â”€â”€ services/backend/app/main.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€â”€ ğŸ” Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Sensor Server)
â”‚   â””â”€â”€ docker-compose.sensor.yml
â”‚       â”‚
â”‚       â”œâ”€â”€ suricata â”€â”€â–º agents/suricata/Dockerfile
â”‚       â”‚                â””â”€â”€ agents/suricata/entrypoint.sh
â”‚       â”‚
â”‚       â”œâ”€â”€ suricata_shipper â”€â”€â–º agents/suricata_shipper/Dockerfile
â”‚       â”‚                        â””â”€â”€ agents/suricata_shipper/agent.py
â”‚       â”‚
â”‚       â”œâ”€â”€ auth_collector â”€â”€â–º agents/auth_collector/Dockerfile
â”‚       â”‚                      â””â”€â”€ agents/auth_collector/agent.py
â”‚       â”‚
â”‚       â””â”€â”€ flow_collector â”€â”€â–º agents/flow_collector/Dockerfile
â”‚                              â””â”€â”€ agents/flow_collector/agent.py
â”‚
â””â”€â”€ ğŸ“š Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    â”œâ”€â”€ .env.example
    â”œâ”€â”€ README.md
    â”œâ”€â”€ docker-setup.md
    â””â”€â”€ scripts/
```

---

## ğŸ”„ ØªØ³Ù„Ø³Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° (Analysis Server)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         docker compose up -d                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£ PostgreSQL Container                                                    â”‚
â”‚                                                                             â”‚
â”‚  Dockerfile: postgres:15-alpine (Ø±Ø³Ù…ÙŠ)                                      â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€â–º scripts/init_db.sql                                              â”‚
â”‚            â”‚                                                                â”‚
â”‚            â”œâ”€â”€ CREATE TABLE devices (...)                                   â”‚
â”‚            â”œâ”€â”€ CREATE TABLE raw_events (...)                                â”‚
â”‚            â””â”€â”€ CREATE TABLE detections (...)                                â”‚
â”‚                                                                             â”‚
â”‚  âœ… Healthcheck: pg_isready                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                          ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ Ø§Ù„Ù€ healthcheck
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£ Backend Container                                                       â”‚
â”‚                                                                             â”‚
â”‚  services/backend/Dockerfile                                                â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ FROM python:3.11-slim                                             â”‚
â”‚       â”œâ”€â”€ pip install -r requirements.txt                                   â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€ CMD: uvicorn app.main:app                                         â”‚
â”‚                    â”‚                                                        â”‚
â”‚                    â–¼                                                        â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚           â”‚  app/main.py (Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)                         â”‚    â”‚
â”‚           â”‚       â”‚                                                    â”‚    â”‚
â”‚           â”‚       â”œâ”€â”€ @asynccontextmanager lifespan()                  â”‚    â”‚
â”‚           â”‚       â”‚       â”‚                                            â”‚    â”‚
â”‚           â”‚       â”‚       â””â”€â”€ load_all_models() â†â”€â”€ models_loader.py   â”‚    â”‚
â”‚           â”‚       â”‚               â”‚                                    â”‚    â”‚
â”‚           â”‚       â”‚               â”œâ”€â”€ SSH LSTM â†â”€â”€ models/ssh/         â”‚    â”‚
â”‚           â”‚       â”‚               â””â”€â”€ Network ML â†â”€â”€ models/network/   â”‚    â”‚
â”‚           â”‚       â”‚                                                    â”‚    â”‚
â”‚           â”‚       â”œâ”€â”€ app.mount("/static", ...)                        â”‚    â”‚
â”‚           â”‚       â”‚                                                    â”‚    â”‚
â”‚           â”‚       â”œâ”€â”€ app.include_router(ui_router)                    â”‚    â”‚
â”‚           â”‚       â”‚       â””â”€â”€ ui/routes.py                             â”‚    â”‚
â”‚           â”‚       â”‚           â””â”€â”€ templates/*.html                     â”‚    â”‚
â”‚           â”‚       â”‚                                                    â”‚    â”‚
â”‚           â”‚       â”œâ”€â”€ app.include_router(auth_router)                  â”‚    â”‚
â”‚           â”‚       â”‚       â””â”€â”€ ingest/auth_ingest.py                    â”‚    â”‚
â”‚           â”‚       â”‚                                                    â”‚    â”‚
â”‚           â”‚       â”œâ”€â”€ app.include_router(suricata_router)              â”‚    â”‚
â”‚           â”‚       â”‚       â””â”€â”€ ingest/suricata_ingest.py                â”‚    â”‚
â”‚           â”‚       â”‚                                                    â”‚    â”‚
â”‚           â”‚       â””â”€â”€ app.include_router(flow_router)                  â”‚    â”‚
â”‚           â”‚               â””â”€â”€ ingest/flow_ingest.py                    â”‚    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  âœ… Listening on: 0.0.0.0:8000                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ØªØ³Ù„Ø³Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° (Sensor Server)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         docker compose up -d                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                        â”‚                        â”‚
           â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£ Suricata      â”‚    â”‚  4ï¸âƒ£ Auth Collector â”‚    â”‚  5ï¸âƒ£ Flow Collector â”‚
â”‚                  â”‚    â”‚                  â”‚    â”‚                  â”‚
â”‚  Dockerfile:     â”‚    â”‚  Dockerfile:     â”‚    â”‚  Dockerfile:     â”‚
â”‚  jasonish/       â”‚    â”‚  python:3.11     â”‚    â”‚  python:3.11     â”‚
â”‚  suricata:7.0    â”‚    â”‚                  â”‚    â”‚  + libpcap       â”‚
â”‚       â”‚          â”‚    â”‚       â”‚          â”‚    â”‚       â”‚          â”‚
â”‚       â–¼          â”‚    â”‚       â–¼          â”‚    â”‚       â–¼          â”‚
â”‚  entrypoint.sh   â”‚    â”‚    agent.py      â”‚    â”‚    agent.py      â”‚
â”‚       â”‚          â”‚    â”‚       â”‚          â”‚    â”‚       â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚    â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚    â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚
â”‚  â”‚suricata-â”‚     â”‚    â”‚  â”‚tail -F  â”‚     â”‚    â”‚  â”‚NFStream â”‚     â”‚
â”‚  â”‚update   â”‚     â”‚    â”‚  â”‚auth.log â”‚     â”‚    â”‚  â”‚capture  â”‚     â”‚
â”‚  â”‚         â”‚     â”‚    â”‚  â”‚         â”‚     â”‚    â”‚  â”‚         â”‚     â”‚
â”‚  â”‚suricata â”‚     â”‚    â”‚  â”‚POST â†’   â”‚     â”‚    â”‚  â”‚POST â†’   â”‚     â”‚
â”‚  â”‚-i ens33 â”‚     â”‚    â”‚  â”‚/ingest/ â”‚     â”‚    â”‚  â”‚/ingest/ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚    â”‚  â”‚auth     â”‚     â”‚    â”‚  â”‚flow     â”‚     â”‚
â”‚       â”‚          â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â–¼          â”‚    â”‚                  â”‚    â”‚                  â”‚
â”‚  eve.json        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚       â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£ Suricata       â”‚
â”‚    Shipper       â”‚
â”‚                  â”‚
â”‚  agent.py        â”‚
â”‚       â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”‚
â”‚  â”‚tail -F  â”‚     â”‚
â”‚  â”‚eve.json â”‚     â”‚
â”‚  â”‚         â”‚     â”‚
â”‚  â”‚POST â†’   â”‚     â”‚
â”‚  â”‚/ingest/ â”‚     â”‚
â”‚  â”‚suricata â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (Backend)

```
services/backend/app/
â”‚
â”œâ”€â”€ ğŸ“ main.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
â”‚   â”‚
â”‚   â”œâ”€â”€ ÙŠØ³ØªÙˆØ±Ø¯ â”€â”€â–º config.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Settings)
â”‚   â”‚                 â””â”€â”€ DATABASE_URL, API_KEY, paths
â”‚   â”‚
â”‚   â”œâ”€â”€ ÙŠØ³ØªÙˆØ±Ø¯ â”€â”€â–º models_loader.py â”€â”€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
â”‚   â”‚                 â”‚
â”‚   â”‚                 â”œâ”€â”€ SSHLSTMModel.load()
â”‚   â”‚                 â”‚   â””â”€â”€ models/ssh/ssh_lstm.joblib
â”‚   â”‚                 â”‚
â”‚   â”‚                 â””â”€â”€ NetworkMLModel.load()
â”‚   â”‚                     â”œâ”€â”€ models/network/model.joblib
â”‚   â”‚                     â”œâ”€â”€ models/network/feature_list.json
â”‚   â”‚                     â”œâ”€â”€ models/network/label_map.json
â”‚   â”‚                     â””â”€â”€ models/network/preprocess_config.json
â”‚   â”‚
â”‚   â”œâ”€â”€ ÙŠØ³ØªÙˆØ±Ø¯ â”€â”€â–º ui/routes.py â”€â”€â”€â”€â”€â”€ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
â”‚   â”‚                 â”‚
â”‚   â”‚                 â”œâ”€â”€ GET / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º templates/dashboard.html
â”‚   â”‚                 â”œâ”€â”€ GET /alerts â”€â”€â”€â”€â–º templates/alerts.html
â”‚   â”‚                 â”œâ”€â”€ GET /events/* â”€â”€â–º templates/*_events.html
â”‚   â”‚                 â””â”€â”€ GET /models â”€â”€â”€â”€â–º templates/models.html
â”‚   â”‚
â”‚   â””â”€â”€ ÙŠØ³ØªÙˆØ±Ø¯ â”€â”€â–º ingest/*.py â”€â”€â”€â”€â”€â”€â”€â”€ Ù†Ù‚Ø§Ø· Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
â”‚                     â”‚
â”‚                     â”œâ”€â”€ auth_ingest.py
â”‚                     â”‚   â””â”€â”€ POST /api/v1/ingest/auth
â”‚                     â”‚       â””â”€â”€ ÙŠØ³ØªØ®Ø¯Ù…: ssh_lstm_detector.py
â”‚                     â”‚
â”‚                     â”œâ”€â”€ suricata_ingest.py
â”‚                     â”‚   â””â”€â”€ POST /api/v1/ingest/suricata
â”‚                     â”‚       â””â”€â”€ ÙŠØ³ØªØ®Ø¯Ù…: severity.py
â”‚                     â”‚
â”‚                     â””â”€â”€ flow_ingest.py
â”‚                         â””â”€â”€ POST /api/v1/ingest/flow
â”‚                             â””â”€â”€ ÙŠØ³ØªØ®Ø¯Ù…: network_ml_detector.py
â”‚
â”œâ”€â”€ ğŸ“‚ detectors/ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„ÙƒØ´Ù
â”‚   â”‚
â”‚   â”œâ”€â”€ ssh_lstm_detector.py
â”‚   â”‚   â”œâ”€â”€ parse_auth_line() â”€â”€â”€â”€â”€â”€ ØªØ­Ù„ÙŠÙ„ Ø³Ø·Ø± auth.log
â”‚   â”‚   â”œâ”€â”€ SSHEventTracker â”€â”€â”€â”€â”€â”€â”€â”€ ØªØªØ¨Ø¹ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒÙ„ IP
â”‚   â”‚   â””â”€â”€ analyze_auth_event() â”€â”€â”€ ÙƒØ´Ù Ø§Ù„Ù€ brute force
â”‚   â”‚
â”‚   â”œâ”€â”€ network_ml_detector.py
â”‚   â”‚   â”œâ”€â”€ preprocess_features() â”€â”€ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â”‚   â”‚   â””â”€â”€ analyze_flow() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ØªØµÙ†ÙŠÙ Ø§Ù„ØªØ¯ÙÙ‚
â”‚   â”‚
â”‚   â”œâ”€â”€ network_feature_mapper.py
â”‚   â”‚   â””â”€â”€ map_flow_to_features() â”€ ØªØ­ÙˆÙŠÙ„ NFStream â†’ CIC-IDS
â”‚   â”‚
â”‚   â””â”€â”€ severity.py
â”‚       â”œâ”€â”€ get_suricata_severity()
â”‚       â”œâ”€â”€ get_network_ml_severity()
â”‚       â””â”€â”€ get_ssh_severity()
â”‚
â”œâ”€â”€ ğŸ“‚ templates/ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ù‚ÙˆØ§Ù„Ø¨ HTML
â”‚   â”œâ”€â”€ base.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
â”‚   â”œâ”€â”€ dashboard.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
â”‚   â”œâ”€â”€ alerts.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ØµÙØ­Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
â”‚   â”œâ”€â”€ auth_events.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø£Ø­Ø¯Ø§Ø« SSH
â”‚   â”œâ”€â”€ flow_events.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ¯ÙÙ‚
â”‚   â”œâ”€â”€ suricata_events.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø£Ø­Ø¯Ø§Ø« Suricata
â”‚   â””â”€â”€ models.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
â”‚
â”œâ”€â”€ ğŸ“‚ static/ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ù…Ù„ÙØ§Øª Ø«Ø§Ø¨ØªØ©
â”‚   â”œâ”€â”€ styles.css â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
â”‚   â””â”€â”€ app.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
â”‚
â”œâ”€â”€ db.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â”‚   â”œâ”€â”€ Device, RawEvent, Detection â”€â”€â”€ Ø§Ù„Ù€ Models
â”‚   â”œâ”€â”€ get_session() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø¬Ù„Ø³Ø© DB
â”‚   â”œâ”€â”€ insert_raw_event() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø¥Ø¯Ø±Ø§Ø¬ Ø­Ø¯Ø«
â”‚   â”œâ”€â”€ insert_detection() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø¥Ø¯Ø±Ø§Ø¬ ØªÙ†Ø¨ÙŠÙ‡
â”‚   â””â”€â”€ get_stats() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
â”‚
â”œâ”€â”€ schemas.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â”‚   â”œâ”€â”€ AuthEventPayload
â”‚   â”œâ”€â”€ SuricataEventPayload
â”‚   â”œâ”€â”€ FlowEventPayload
â”‚   â””â”€â”€ IngestResponse
â”‚
â””â”€â”€ security.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø§Ù„Ø­Ù…Ø§ÙŠØ©
    â””â”€â”€ verify_api_key() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† INGEST_API_KEY
```

---

## ğŸ”€ ØªØ¯ÙÙ‚ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø¯Ø« (Ù…Ø«Ø§Ù„: SSH Event)

```
1. auth_collector ÙŠÙ‚Ø±Ø£ Ø³Ø·Ø± Ù…Ù† auth.log
   â”‚
   â””â”€â”€â–º "Jan 12 20:30:15 sensor sshd[1234]: Failed password for admin from <Ù…Ù‡Ø§Ø¬Ù…_IP>"

2. ÙŠØ±Ø³Ù„ POST request
   â”‚
   â””â”€â”€â–º POST http://<ANALYZER_IP>:8000/api/v1/ingest/auth
        Headers: INGEST_API_KEY: <INGEST_API_KEY>
        Body: {
          "device_id": "sensor-01",
          "hostname": "sensor-server",
          "device_ip": "<ÙŠÙÙƒØªØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹>",
          "line": "Jan 12 20:30:15 sensor sshd...",
          "timestamp": "2026-01-12T20:30:15Z"
        }

3. Backend ÙŠØ³ØªÙ‚Ø¨Ù„ ÙÙŠ auth_ingest.py
   â”‚
   â”œâ”€â”€â–º security.py: verify_api_key() âœ“
   â”‚
   â”œâ”€â”€â–º db.py: ensure_device() â”€â”€ ØªØ£ÙƒØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø³Ø¬Ù„
   â”‚
   â”œâ”€â”€â–º db.py: insert_raw_event() â”€â”€ Ø®Ø²Ù‘Ù† Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø®Ø§Ù…
   â”‚
   â””â”€â”€â–º ssh_lstm_detector.py: analyze_auth_event()
        â”‚
        â”œâ”€â”€â–º parse_auth_line()
        â”‚    â””â”€â”€ token="FAILED_PASSWORD", src_ip="<Ù…Ù‡Ø§Ø¬Ù…_IP>"
        â”‚
        â”œâ”€â”€â–º SSHEventTracker.add_event()
        â”‚    â””â”€â”€ Ø£Ø¶Ù Ù„Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø©
        â”‚
        â”œâ”€â”€â–º SSHEventTracker.add_failed_attempt()
        â”‚    â””â”€â”€ Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©++
        â”‚
        â”œâ”€â”€â–º Ø¥Ø°Ø§ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª > 5:
        â”‚    â””â”€â”€ Ø£Ù†Ø´Ø¦ ØªÙ†Ø¨ÙŠÙ‡ BRUTE_FORCE
        â”‚
        â””â”€â”€â–º Ø£Ùˆ Ø´ØºÙ‘Ù„ LSTM model
             â””â”€â”€ Ø¥Ø°Ø§ anomaly_score > threshold:
                 â””â”€â”€ Ø£Ù†Ø´Ø¦ ØªÙ†Ø¨ÙŠÙ‡ SSH_ANOMALY

4. Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡:
   â”‚
   â””â”€â”€â–º db.py: insert_detection()
        â”‚
        â””â”€â”€â–º ÙŠÙØ®Ø²Ù† ÙÙŠ Ø¬Ø¯ÙˆÙ„ detections

5. Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©):
   â”‚
   â””â”€â”€â–º GET /api/v1/recent-detections
        â”‚
        â””â”€â”€â–º ÙŠÙØ¸Ù‡Ø± ÙÙŠ Dashboard
```

---

## ğŸ¯ Ù…Ù„Ø®Øµ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„

| Ø§Ù„Ù…Ù„Ù | Ø§Ù„Ø¯ÙˆØ± | ÙŠÙØ´ØºÙ‘Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© |
|-------|-------|--------------|
| `docker-compose.analysis.yml` | ÙŠÙØ´ØºÙ‘Ù„ Analysis Stack | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… |
| `docker-compose.sensor.yml` | ÙŠÙØ´ØºÙ‘Ù„ Sensor Stack | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… |
| `scripts/init_db.sql` | Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ | PostgreSQL |
| `app/main.py` | Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ | Uvicorn |
| `agents/*/agent.py` | Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ | Docker |
| `agents/suricata/entrypoint.sh` | Suricata | Docker |

---

## ğŸ”— Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª

```
User Request â”€â”€â–º auth_ingest.py
                     â”‚
                     â”œâ”€â”€ verify_api_key() â—„â”€â”€ security.py
                     â”‚
                     â”œâ”€â”€ ensure_device() â—„â”€â”€ db.py
                     â”‚
                     â”œâ”€â”€ insert_raw_event() â—„â”€â”€ db.py
                     â”‚
                     â”œâ”€â”€ analyze_auth_event() â—„â”€â”€ ssh_lstm_detector.py
                     â”‚       â”‚
                     â”‚       â”œâ”€â”€ parse_auth_line()
                     â”‚       â”‚
                     â”‚       â”œâ”€â”€ SSHLSTMModel.predict() â—„â”€â”€ models_loader.py
                     â”‚       â”‚
                     â”‚       â””â”€â”€ get_ssh_severity() â—„â”€â”€ severity.py
                     â”‚
                     â””â”€â”€ insert_detection() â—„â”€â”€ db.py
```

---

**ğŸ‰ Ø§Ù„Ø¢Ù† Ù„Ø¯ÙŠÙƒ Ø®Ø±ÙŠØ·Ø© ÙƒØ§Ù…Ù„Ø© Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹!**
