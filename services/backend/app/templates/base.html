<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Analytical-Intelligence v1 - Real-time Security Intelligence Dashboard">
    <title>{% block title %}{{ page_title }} - Analytical-Intelligence{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
    {% block extra_head %}{% endblock %}
</head>

<body class="app-shell">
    <!-- Left Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span class="logo">üõ°Ô∏è</span>
            <span class="brand-text">AI v1</span>
            <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">‚ò∞</button>
        </div>

        <nav class="sidebar-nav">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link {% if page_title == 'Dashboard' %}active{% endif %}">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/alerts" class="nav-link {% if page_title == 'Alerts' %}active{% endif %}">
                        <span class="nav-icon">üö®</span>
                        <span class="nav-text">Alerts</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/devices"
                        class="nav-link {% if page_title == 'Devices' or 'Device:' in page_title %}active{% endif %}">
                        <span class="nav-icon">üíª</span>
                        <span class="nav-text">Devices</span>
                    </a>
                </li>

                <!-- Events Submenu -->
                <li class="nav-item has-submenu">
                    <a href="#" class="nav-link submenu-toggle {% if 'Events' in page_title %}active{% endif %}">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-text">Events</span>
                        <span class="submenu-arrow">‚ñæ</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="/events/auth" class="{% if page_title == 'Auth Events' %}active{% endif %}">Auth
                                Events</a></li>
                        <li><a href="/events/flows" class="{% if page_title == 'Flow Events' %}active{% endif %}">Flow
                                Events</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a href="/models" class="nav-link {% if page_title == 'Models' %}active{% endif %}">
                        <span class="nav-icon">ü§ñ</span>
                        <span class="nav-text">Models</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/reports" class="nav-link {% if page_title == 'Reports' %}active{% endif %}">
                        <span class="nav-icon">üìà</span>
                        <span class="nav-text">Reports</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="status-indicator-wrapper">
                <span class="status-indicator online"></span>
                <span class="status-text" id="last-update">Online</span>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-wrapper">
        <!-- Top Bar (minimal) -->
        <header class="topbar">
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Open menu">‚ò∞</button>
            <div class="topbar-brand">
                <span class="brand-full">Analytical-Intelligence v1</span>
            </div>
            <div class="topbar-status">
                <span class="status-indicator online"></span>
                <span id="topbar-last-update">Last update: --</span>
            </div>
        </header>

        <main class="container">
            {% block content %}{% endblock %}
        </main>

        <footer class="footer">
            <div class="footer-content">
                <span class="company">&copy; <span id="current-year"></span> Analytical Intelligence</span>
                <span class="separator">|</span>
                <span class="version">Version 1.0</span>
            </div>
        </footer>
    </div>

    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <script src="/static/app.js"></script>
    <script>
        // Sidebar toggle functionality
        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const overlay = document.getElementById('sidebar-overlay');

            // Desktop toggle (collapse/expand)
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function () {
                    sidebar.classList.toggle('collapsed');
                    localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
                });
            }

            // Mobile menu toggle
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function () {
                    sidebar.classList.add('mobile-open');
                    overlay.classList.add('active');
                });
            }

            // Close mobile menu on overlay click
            if (overlay) {
                overlay.addEventListener('click', function () {
                    sidebar.classList.remove('mobile-open');
                    overlay.classList.remove('active');
                });
            }

            // Submenu toggle
            document.querySelectorAll('.submenu-toggle').forEach(function (toggle) {
                toggle.addEventListener('click', function (e) {
                    e.preventDefault();
                    const parent = this.parentElement;
                    parent.classList.toggle('open');
                });
            });

            // Restore sidebar state
            if (localStorage.getItem('sidebarCollapsed') === 'true') {
                sidebar.classList.add('collapsed');
            }

            // Keep events submenu open if we're on an events page
            if (document.querySelector('.submenu-toggle.active')) {
                document.querySelector('.submenu-toggle.active').parentElement.classList.add('open');
            }

            // Set current year in footer
            const yearSpan = document.getElementById('current-year');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>

</html>